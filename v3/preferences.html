<!doctype html>
<html>
	<head>
		<title>Futura Weather Redux Preferences</title>
		<style type="text/css">
			body {
				font-family: futura, sans-serif;
			}
			
			label, select, input, button {
				display: block;
			}
			
			select, input, button {
				margin-bottom: 18px;
			}
		</style>
		<script>
			var translations = {
				"0": {
					"name":        "English",
					"translation": "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec,Mon,Tue,Wed,Thu,Fri,Sat,Sun"
				},
				"1": {
					"name":        "Swedish",
					"translation": "Jan,Feb,Mar,Apr,Maj,Jun,Jul,Aug,Sep,Okt,Nov,Dec,Mån,Tis,Ons,Tor,Fre,Lör,Sön"
				},
				"2": {
					"name":        "Danish",
					"translation": "Jan,Feb,Mar,Apr,Maj,Jun,Jul,Aug,Sep,Okt,Nov,Dec,Man,Tir,Ons,Tor,Fre,Lør,Søn"
				},
				"3": {
					"name":        "Dutch",
					"translation": "Jan,Feb,Mrt,Apr,Mei,Jun,Jul,Aug,Sep,Okt,Nov,Dec,Ma,Di,Wo,Do,Vr,Za,Zo"
				},
				"4": {
					"name":        "French",
					"translation": "Janv,Févr,Mars,Avril,Mai,Juin,Juil,Août,Sept,Oct,Nov,Déc,Lun,Mar,Mer,Jeu,Ven,Sam,Dim"
				},
				"5": {
					"name":        "Finnish",
					"translation": "Tammi,Helmi,Maalis,Huhti,Touko,Kesä,Heinä,Elo,Syys,Loka,Marras,Joulu,Ma,Ti,Ke,To,Pe,La,Su"
				},
				"6": {
					"name":        "German",
					"translation": "Jan,Feb,Mär,Apr,Mai,Jun,Jul,Aug,Sep,Okt,Nov,Dez,Mo,Di,Mi,Do,Fr,Sa,So"
				},
				"7": {
					"name":        "Italian",
					"translation": "Gen,Feb,Mar,Apr,Mag,Giu,Lug,Ago,Set,Ott,Nov,Dic,Lun,Mar,Mer,Gio,Ven,Sab,Dom"
				},
				"8": {
					"name":        "Spanish",
					"translation": "Ene,Feb,Mar,Abr,May,Jun,Jul,Ago,Sep,Oct,Nov,Dic,Lun,Mar,Mié,Jue,Vie,Sáb,Dom"
				}
			};

			
			function queryStringParams() {
				var params = {};
				var queries = window.location.search.substring(1).split("&");
				for(var i = 0; i < queries.length; i++) {
					var p = queries[i].split("=");
					params[p[0]] = p[1];
				}
				
				return params;
			}
			
			function buildLanguagePicker() {
				var select = document.getElementById("language");
				for(var key in translations) {
					var option = document.createElement("option");
					option.value = key;
					option.innerHTML = translations[key].name;
					
					select.appendChild(option);
				}
			}
			
			window.onload = function() {
				buildLanguagePicker();
				
				var params = queryStringParams();
				for(var key in params) {
					var elements = document.getElementsByName(key);
					if(elements.length > 0) {
						var e = elements[0];
						if(e.type == "checkbox")
							e.checked = (params[key] != 0);
						else
							e.value = params[key];
					}
				}
			};
			
				
			window.onsubmit = function(e) {
				var params = {};
				var children = e.target.childNodes;
				for(var i = 0; i < children.length; i++) {
					if(children[i].name && children[i].value) {
						if(children[i].type == "checkbox") {
							params[children[i].name] = children[i].checked ? 1 : 0;
						}
						else if(children[i].name == "languageCode") {
							params["translation"] = translations[children[i].value].translation;
							params[children[i].name] = Number(children[i].value);
						}
						else {
							params[children[i].name] = children[i].value;
						}
					}
				}
				
				window.location = "pebblejs://close#" + JSON.stringify(params);
				return false;
			}
		</script>
	</head>
	<body>
		<h1>Futura Weather Redux</h1>
		<form name="preferences">
			<label for="tempFormat">Temperature format</label>
			<select name="tempFormat">
				<option value="1">Celsius</option>
				<option value="2">Fahrenheit</option>
			</select>
			<label for="weatherUpdateFreq">Weather update frequency</label>
			<select name="weatherUpdateFreq">
				<option value="600">Every 10 minutes</option>
				<option value="900">Every 15 minutes</option>
				<option value="1800">Every 30 minutes</option>
				<option value="3600">Every hour</option>
			</select>
			<label for="weatherOutdatedTime">Hide outdated weather after:</label>
			<select name="weatherOutdatedTime">
				<option value="1800">30 minutes</option>
				<option value="3600">1 hour</option>
				<option value="10800">3 hours</option>
			</select>
			<label for="weatherProvider">Weather data provider</label>
			<select name="weatherProvider">
				<option value="1">OpenWeatherMap</option>
				<option value="2">Yahoo Weather</option>
			</select>
			<label for="statusbar">Show statusbar</label>
			<input name="statusbar" type="checkbox" />
			<label for="languageCode">Language</label>
			<select name="languageCode" id="language">
				<!-- Constructed in buildLanguagePicker() -->
			</select>
			<button name="save" type="submit">Save</button>
		</form>
	</body>
</html>